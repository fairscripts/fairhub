local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

local movingAnimals = Workspace:WaitForChild("MovingAnimals")

-- Função para achar o ProximityPrompt dentro de um modelo
local function acharPrompt(model)
    for _, desc in ipairs(model:GetDescendants()) do
        if desc:IsA("ProximityPrompt") then
            return desc
        end
    end
    return nil
end

-- Função para seguir e interagir com o modelo
local function seguirEInteragir(model)
    local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end

    local firePrompt = (typeof(fireproximityprompt) == "function" and fireproximityprompt)
        or (typeof(fireProximityPrompt) == "function" and fireProximityPrompt)

    local connection
    connection = RunService.Heartbeat:Connect(function()
        if not model or not model.Parent then
            connection:Disconnect()
            return
        end

        -- Seguir o modelo
        local targetPos
        if model.PrimaryPart then
            targetPos = model.PrimaryPart.Position
        else
            local rootPart = model:FindFirstChild("RootPart") or model:FindFirstChild("HumanoidRootPart")
            if rootPart then targetPos = rootPart.Position end
        end
        if targetPos then
            humanoid:MoveTo(targetPos)
        end

        -- Procurar prompt
        local prompt = acharPrompt(model)
        if prompt then
            if firePrompt then
                pcall(function() firePrompt(prompt, 2) end)
            else
                local VIM = game:GetService("VirtualInputManager")
                VIM:SendKeyEvent(true, Enum.KeyCode.E, false, game)
                task.wait(2)
                VIM:SendKeyEvent(false, Enum.KeyCode.E, false, game)
            end
            connection:Disconnect()
        end
    end)
end

-- Monitora quando um modelo novo é adicionado
movingAnimals.ChildAdded:Connect(function(model)
    if model:IsA("Model") then
        task.wait(0.2) -- espera hierarquia carregar
        local infoFolder = model:FindFirstChild("HumanoidRootPart")
            and model.HumanoidRootPart:FindFirstChild("Info")

        if infoFolder then
            local displayNameLabel = infoFolder:FindFirstChild("DisplayName", true) -- busca recursiva
            if displayNameLabel and displayNameLabel:IsA("TextLabel") then
                print("[Modelo:", model.Name, "] DisplayName =", displayNameLabel.Text)
                if displayNameLabel.Text == "Tung Tung Tung Sahur" then
                    seguirEInteragir(model)
                end
            end
        end
    end
end)
