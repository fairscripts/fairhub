local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer or Players.PlayerAdded:Wait()

-- ===================== LISTAS =====================
local lists = {
    Secrets = {
        "La Vacca Saturno Saturnita","Karkerkar Kurkur","Chimpanzini Spiderini","Agarrini la Palini","Los Tralaleritos","Las Tralaleritas",
        "Las Vaquitas Saturnitas","Graipuss Medussi","Chicleteira Bicicleteira","La Grande Combinasion","Los Combinasionas","Nuclearo Dinossauro",
        "Los Hotspotsitos","Garama and Madundung","Dragon Cannelloni","Secret Lucky Block","Pot Hotspot","Esok Sekolah"
    },
    BrainrotGods = {
        "Cocofanto Elefanto","Girafa Celestre","Gattatino Neonino","Matteo","Tralalero Tralala","Los Crocodillitos","Espresso Signora",
        "Odin Din Din Dun","Statutino Libertino","Tukanno Bananno","Trenostruzzo Turbo 3000","Trippi Troppi Troppa Trippa","Ballerino Lololo",
        "Los Tungtungtungcitos","Piccione Macchina","Brainrot God Lucky Block","Orcalero Orcala"
    },
    Test = {
        "Tung Tung Tung Sahur"
    }
}
local activeLists = { Secrets = false, BrainrotGods = false, Test = false }

-- ===================== GUI =====================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FollowUI"
ScreenGui.Parent = game:GetService("CoreGui")

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0.4, 0, 0.25, 0)
MainFrame.Position = UDim2.new(0.3, 0, 0.375, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local TabsFrame = Instance.new("Frame")
TabsFrame.Size = UDim2.new(0.25, 0, 1, 0)
TabsFrame.Position = UDim2.new(0, 0, 0, 0)
TabsFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
TabsFrame.Parent = MainFrame

local ContentFrame = Instance.new("Frame")
ContentFrame.Size = UDim2.new(0.75, 0, 1, 0)
ContentFrame.Position = UDim2.new(0.25, 0, 0, 0)
ContentFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
ContentFrame.Parent = MainFrame

local function createTabButton(name, yPos)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, 0, 0, 40)
    btn.Position = UDim2.new(0, 0, 0, yPos)
    btn.Text = name
    btn.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Parent = TabsFrame
    return btn
end

local function createCheckbox(text, yPos, listName)
    local cb = Instance.new("TextButton")
    cb.Size = UDim2.new(1, -20, 0, 30)
    cb.Position = UDim2.new(0, 10, 0, yPos)
    cb.Text = "[ ] " .. text
    cb.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    cb.TextColor3 = Color3.fromRGB(255, 255, 255)
    cb.Parent = ContentFrame

    cb.MouseButton1Click:Connect(function()
        activeLists[listName] = not activeLists[listName]
        cb.Text = (activeLists[listName] and "[X] " or "[ ] ") .. text
    end)
end

local AutoFarmTab = createTabButton("Auto Farm", 0)
local MiscTab = createTabButton("Misc", 40)

-- UI de seguir
local FollowingLabel = Instance.new("TextLabel")
FollowingLabel.Size = UDim2.new(0, 300, 0, 40)
FollowingLabel.Position = UDim2.new(1, -310, 1, -50)
FollowingLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
FollowingLabel.BackgroundTransparency = 0.3
FollowingLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
FollowingLabel.TextSize = 18
FollowingLabel.Visible = false
FollowingLabel.Parent = ScreenGui

-- Abas
local function showAutoFarm()
    for _, c in pairs(ContentFrame:GetChildren()) do c:Destroy() end
    createCheckbox("Auto Farm Secrets", 20, "Secrets")
    createCheckbox("Auto Farm Brainrot Gods", 60, "BrainrotGods")
    createCheckbox("Auto Farm Test", 100, "Test")
end
local function showMisc()
    for _, c in pairs(ContentFrame:GetChildren()) do c:Destroy() end
end

AutoFarmTab.MouseButton1Click:Connect(function()
    AutoFarmTab.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
    MiscTab.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    showAutoFarm()
end)
MiscTab.MouseButton1Click:Connect(function()
    MiscTab.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
    AutoFarmTab.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    showMisc()
end)

showAutoFarm()
AutoFarmTab.BackgroundColor3 = Color3.fromRGB(0, 170, 0)

-- ===================== FUNÇÕES AUXILIARES =====================
local function waitForCharacterParts(timeout)
    local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local hum = char:WaitForChild("Humanoid", timeout)
    local hrp = char:WaitForChild("HumanoidRootPart", timeout)
    return char, hum, hrp
end

local firePromptFn = fireproximityprompt or fireProximityPrompt
local function safeFirePrompt(prompt, holdTime)
    holdTime = holdTime or 2
    if prompt and prompt:IsA("ProximityPrompt") then
        local ok = pcall(function() firePromptFn(prompt, holdTime) end)
        return ok
    end
    return false
end

local function acharPrompt(model)
    for _,desc in ipairs(model:GetDescendants()) do
        if desc:IsA("ProximityPrompt") then
            return desc
        end
    end
end

local function acharParteAlvo(model)
    return model:FindFirstChild("HumanoidRootPart") or model.PrimaryPart
end

-- ===================== LÓGICA DE FOLLOW =====================
local function seguirEInteragirAteSumir(model, displayName)
    local _, humanoid, hrp = waitForCharacterParts(5)
    local tentativas, lastFireTime, lastDistPrint = 0, 0, 0

    print("[Follow] Iniciando follow em:", displayName)
    FollowingLabel.Text = "Seguindo ("..displayName..")"
    FollowingLabel.Visible = true

    local connection
    connection = RunService.Heartbeat:Connect(function()
        if not model or not model.Parent then
            connection:Disconnect()
            print("[Follow] Modelo removido — parando follow:", displayName)
            FollowingLabel.Visible = false
            return
        end

        local targetPart = acharParteAlvo(model)
        if targetPart then
            local dist = (hrp.Position - targetPart.Position).Magnitude
            if tick() - lastDistPrint > 2 then
                print(string.format("[Follow] Distância até %s: %.2f", displayName, dist))
                lastDistPrint = tick()
            end
            if dist > 2.2 then
                humanoid:MoveTo(targetPart.Position)
            end
        end

        local prompt = acharPrompt(model)
        if prompt and targetPart then
            local distPrompt = (hrp.Position - targetPart.Position).Magnitude
            if distPrompt <= 10 and tentativas < 5 and tick() - lastFireTime >= 2 then
                print("[Follow] Disparando ProximityPrompt em:", displayName)
                safeFirePrompt(prompt, 2)
                tentativas = tentativas + 1
                lastFireTime = tick()
                if tentativas >= 5 then
                    print("[Follow] Parando tentativas de ProximityPrompt:", displayName)
                end
            end
        end
    end)
end

-- ===================== MONITOR =====================
local movingAnimals = Workspace:WaitForChild("MovingAnimals")
movingAnimals.ChildAdded:Connect(function(model)
    task.wait(0.5)
    local infoFolder = model:FindFirstChild("HumanoidRootPart") and model.HumanoidRootPart:FindFirstChild("Info")
    if not infoFolder then return end

    local displayLabel = infoFolder:FindFirstChild("DisplayName", true)
    if displayLabel and displayLabel:IsA("TextLabel") then
        local displayName = displayLabel.Text or ""
        print(string.format("[Spawn] Modelo: %s | DisplayName: %s", model.Name, displayName))
        for listName, names in pairs(lists) do
            if activeLists[listName] then
                for _, n in ipairs(names) do
                    if displayName == n then
                        seguirEInteragirAteSumir(model, displayName)
                        return
                    end
                end
            end
        end
    end
end)

print("[Script] Pronto — UI e lógica de seguir carregadas.")
