local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer or Players.PlayerAdded:Wait()
local movingAnimals = Workspace:WaitForChild("MovingAnimals")
local renderedAnimals = Workspace:WaitForChild("RenderedMovingAnimals")

-- Função para achar parte alvo
local function acharParteAlvo(model)
    if not model then return nil end
    return model:FindFirstChild("HumanoidRootPart") or model:FindFirstChild("RootPart") or model.PrimaryPart
end

-- Função para seguir até o modelo sumir
local function seguirModelo(model)
    local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
    local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not humanoid or not hrp then return end

    print("[Seguindo modelo em RenderedMovingAnimals]:", model.Name)

    local connection
    connection = RunService.Heartbeat:Connect(function()
        if not model or not model.Parent then
            print("[Parando] Modelo removido:", model and model.Name or "nil")
            connection:Disconnect()
            return
        end

        local targetPart = acharParteAlvo(model)
        if targetPart then
            humanoid:MoveTo(targetPart.Position)
        end
    end)
end

-- Monitora novos modelos em MovingAnimals
movingAnimals.ChildAdded:Connect(function(model)
    if model:IsA("Model") then
        task.wait(0.2)
        local infoFolder = model:FindFirstChild("HumanoidRootPart") and model.HumanoidRootPart:FindFirstChild("Info")
        if infoFolder then
            local displayNameLabel = infoFolder:FindFirstChild("DisplayName", true)
            if displayNameLabel and displayNameLabel:IsA("TextLabel") then
                if displayNameLabel.Text == "Tung Tung Tung Sahur" then
                    print("[Encontrado em MovingAnimals]:", model.Name)

                    -- procurar no RenderedMovingAnimals
                    local renderModel = renderedAnimals:FindFirstChild(model.Name)
                    if renderModel then
                        seguirModelo(renderModel)
                    else
                        -- caso ainda não tenha carregado, esperar
                        renderedAnimals.ChildAdded:Connect(function(newModel)
                            if newModel.Name == model.Name then
                                seguirModelo(newModel)
                            end
                        end)
                    end
                end
            end
        end
    end
end)
